<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Button Press App</title>
    <style>
        /* Add your CSS styles here */
        .button-row {
            display: flex;
            align-items: center;
        }
        .button {
            min-width: 64px;
            font-size: 16px;
            padding: 10px 10px;
            margin: 10px;
        }
        .input {
            width: 94px;
            font-size: 16px;
            padding: 10px 10px;
            margin: 10px;
        }
        #copy-button {
            font-size: 16px;
            padding: 10px 10px;
            margin: 10px;
        }
        #clear-button {
            font-size: 16px;
            margin: 5px;
            background-color: #f88;
        }
        #cancel-button {
            font-size: 16px;
            margin: 5px;
            background-color: #f88;
        }
        #log-container {
            font-family: monospace, monospace;
            font-size: 14px;
            padding: 10px 10px;
            margin: 10px;
            max-width: 265px;
            border-style: solid;
        }
    </style>
</head>
<body>
    <div class="button-row">
        <input class="input" type="text" name="type_1" value="Type_1"></input>
        <button class="button">Up</button>
        <button class="button">Down</button>
    </div>
    <div class="button-row">
        <input class="input" type="text" name="type_2" value="Type_2"></input>
        <button class="button">Up</button>
        <button class="button">Down</button>
    </div>
    <div class="button-row">
        <input class="input" type="text" name="type_3" value="Type_3"></input>
        <button class="button">Up</button>
        <button class="button">Down</button>
    </div>
    <div class="button-row">
        <input class="input" type="text" name="type_4" value="Type_4"></input>
        <button class="button">Up</button>
        <button class="button">Down</button>
    </div>
    <div class="button-row">
        <input class="input" type="text" name="type_5" value="Type_5"></input>
        <button class="button">Up</button>
        <button class="button">Down</button>
    </div>
    <div id="log-container"></div>
    <button id="copy-button">Copy to clipboard</button>
    <button id="clear-button">Clear log</button>
    <button id="cancel-button">X</button>

    <script>
        function getCookie(cookieName, emptyValue) {
          const cookies = document.cookie.split(';');
          for (const cookie of cookies) {
            const [name, value] = cookie.trim().split('=');
            if (name === cookieName) {
              return value; // Cookie exists
            }
          }
          return emptyValue; // Cookie does not exist
        }

        // Convert the stringified array back to an actual array
        const log = JSON.parse(getCookie('button_log', '[]'));

        // Load input values from cookie
        for (const input of document.getElementsByClassName('input')) {
            input.value = getCookie(input.name, input.value);
        }

        function toLogString(timestamp, direction, type) {
            return `${timestamp}; ${type}; ${direction}`
        }

        function handleButtonClick(direction, type) {
            const timestamp = new Date().toLocaleTimeString();
            log.push({ timestamp, direction, type });
            console.log(toLogString(timestamp, direction, type));
            updateLogDisplay();
            saveLogToCookie();
        }

        function updateLogDisplay() {
            const logContainer = document.getElementById('log-container');
            logContainer.innerHTML = '';
            log.forEach((entry, index) => {
                const logEntry = document.createElement('div');
                logEntry.textContent = (`${index + 1}; `
                    + toLogString(entry.timestamp, entry.direction, entry.type) + '\n');
                logContainer.appendChild(logEntry);
            });
        }

        function setCookie(name, value) {
            document.cookie = `${name}=${value}; max-age=31536000; path=/`;
        }

        function saveLogToCookie() {
            document.cookie = `button_log=${JSON.stringify(log)}; max-age=31536000; path=/`;
        }

        function copyLog() {
            const logContainer = document.getElementById('log-container');
            navigator.clipboard.writeText(logContainer.textContent);
        }

        function clearLog() {
            if (confirm('Are you sure you want to clear the log?')) {
                document.cookie = 'button_log=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                log.length = 0;
                updateLogDisplay();
            }
        }

        function cancelRecord() {
            if (confirm('Are you sure you want to clear the last record?')) {
                log.pop();
                saveLogToCookie();
                updateLogDisplay();
            }
        }

        for (const button of document.getElementsByClassName('button')) {
            button.addEventListener('click',
                () => handleButtonClick(
                    button.textContent,
                    button.parentElement.getElementsByTagName('input')[0].value
                    )
                );
        }

        for (const input of document.getElementsByClassName('input')) {
            input.addEventListener('change', () => setCookie(input.name, input.value));
        }

        document.getElementById('copy-button').addEventListener('click', copyLog);
        document.getElementById('clear-button').addEventListener('click', clearLog);
        document.getElementById('cancel-button').addEventListener('click', cancelRecord);

        updateLogDisplay();
    </script>
</body>
</html>
